#' editor UI Function
#'
#' @description A shiny Module.
#'
#' @param id,input,output,session Internal parameters for {shiny}.
#'
#' @noRd
#'
#' @importFrom shiny NS tagList
mod_editor_ui <- function(id) {
  ns <- NS(id)
  tagList(
    shiny::fluidRow(
      bslib::layout_column_wrap(
        width = 1/3,
        shiny::actionLink(ns("load_valid_ex"), "Load valid example"),
        shiny::actionLink(ns("load_invalid_ex"), "Load invalid example"),
        shiny::actionLink(ns("reset_editor"), "Clear editor text")
      )
    ), shiny::br(),
    shiny::fluidRow(shiny::uiOutput(ns("ace_editor"))),
    shiny::fluidRow(
      bslib::layout_column_wrap(
        width = 1 / 3,
        shiny::actionButton(ns("validate"), "Validate", icon = icon("check")),
        shiny::downloadButton(ns("download")),
        shiny::actionButton(ns("contribute"), "Share", icon = icon("share-from-square"))
      )
    )
  )
}

#' editor Server Functions
#'
#' @noRd
mod_editor_server <- function(id) {
  moduleServer(id, function(input, output, session) {
    ns <- session$ns
    output$ace_editor <- renderUI({
      shinyAce::aceEditor(ns("editor"),
        fontSize = 18,
        mode = "yaml", theme = "kuroir",
        # TODO: move the value to a utils (business-logic) function, or package data
        value = paste(
          c(
            "id: miiid: # ID",
            "participants:",
            rep("  -  # <PARTICIPANT>", 3),
            "tax_id:",
            rep("  -  # <PARTICIPANT_TAX_ID>", 3),
            "evidence_type:  # <USING Evidence & Conclusion Ontology (ECO)>",
            "reference:  # <DOI>"
          ),
          collapse = "\n"
        ),
        height = "300px",
        tabSize = 2,
        autoComplete = "live",
        autoCompleters = "static",
        # TODO: move the properties to a utils (business-logic) function, or package data
        autoCompleteList = list(
          required = c("id","participants", "tax_id", "evidence_type", "reference"),
          recommended = c("participants_outcome")
        )
      )
    })
  })
}

## To be copied in the UI
# mod_editor_ui("editor_1")

## To be copied in the server
# mod_editor_server("editor_1")
